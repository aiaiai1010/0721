<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Depth Anything Demo</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    img, canvas { max-width: 100%; height: auto; }
    #container { display: flex; gap: 20px; }
    .panel { flex: 1; text-align: center; }
  </style>
</head>
<body>
  <h1>Depth Anything デモ</h1>
  <p>画像を選んで深度マップを生成します。</p>
  <input type="file" id="fileInput" accept="image/*">
  <div id="container">
    <div class="panel">
      <h2>Original Image</h2>
      <img id="origImg" src="" alt="Original">
    </div>
    <div class="panel">
      <h2>Depth Map</h2>
      <canvas id="depthCanvas"></canvas>
    </div>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const origImg = document.getElementById('origImg');
    const depthCanvas = document.getElementById('depthCanvas');
    const ctx = depthCanvas.getContext('2d');

    fileInput.addEventListener('change', async () => {
      const file = fileInput.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = async e => {
        origImg.src = e.target.result;
        await origImg.decode();

        const imgBlob = await fetch(e.target.result).then(r => r.blob());
        const form = new FormData();
        form.append('image', imgBlob);

        try {
          // Hugging Face API（例: depth-anything-base）
          const resp = await fetch(
            'https://api-inference.huggingface.co/models/LiheYoung/depth-anything-base-hf',
            {
              method: 'POST',
              headers: {
                Authorization: 'Bearer YOUR_HUGGINGFACE_API_TOKEN'
              },
              body: form
            }
          );
          const result = await resp.json();
          const depthUrl = result.depth; // API応答に応じ変動

          const depthImg = new Image();
          depthImg.src = depthUrl;
          await depthImg.decode();

          depthCanvas.width = depthImg.naturalWidth;
          depthCanvas.height = depthImg.naturalHeight;
          ctx.drawImage(depthImg, 0, 0);
        } catch(err) {
          console.error(err);
          alert('深度推定に失敗しました。APIトークンやモデル名を確認してください。');
        }
      };
      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>
